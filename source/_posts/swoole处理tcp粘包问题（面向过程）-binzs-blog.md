---
title: Swoole处理Tcp粘包问题（面向过程）
tags: []
id: '31'
categories:
  - - uncategorized
date: 2020-09-20 17:57:38
---

\[TOC\]

##### TCP通信特点

*   TCP 是流式协议没有消息边界，客户端向服务器端发送一次数据，可能会被服务器端分成多次收到。客户端向服务器端发送多条数据。服务器端可能一次全部收到。
*   保证传输的可靠性，顺序。
*   TCP拥有拥塞控制，所以数据包可能会延后发送。

##### TCP粘包

###### 介绍

TCP 粘包是指发送方发送的若干包数据 到 接收方接收时粘成一包，从接收缓冲区看，后一包数据的头紧接着前一包数据的尾。

###### 原因

发送方：发送方需要等缓冲区满才发送出去，造成粘包接收方：接收方不及时接收缓冲区的包，造成多个包接收下图为tcp协议在传输数据的过程：

![](http://qiniu.gaobinzhan.com/2019/12/15/6e9bc93b87dc4.jpg)

###### swoole处理粘包

*   EOF结束协议：EOF切割需要遍历整个数据包的内容，查找EOF，因此会消耗大量CPU资源。上手比较简单
*   固定包头+包体协议：长度检测协议，只需要计算一次长度，数据处理仅进行指针偏移，性能非常高

##### 重现TCP粘包问题

服务端